<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Detalle de Venta</title>
<link rel="stylesheet" href="css/registroVentas.css">
</head>
<body>
<div class="contenedor">
    <h1>Detalle de Venta</h1>

    <!-- Información del cliente -->
    <div class="info-cliente">
        <p><strong>NIT:</strong> <span id="nit">12345678</span></p>
        <p><strong>Nombre:</strong> <span id="nombre">Juan Pérez</span></p>
    </div>

    <!-- Tabla de productos -->
    <table class="tabla-venta">
        <thead>
            <tr>
                <th>Item</th>
                <th>Producto</th>
                <th>Cantidad</th>
                <th>Precio</th>
                <th>Subtotal</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>1</td>
                <td>Cerveza Paceña 440ml</td>
                <td><input type="number" value="1" min="1" class="cantidad"></td>
                <td class="precio">225</td>
                <td class="subtotal">225</td>
            </tr>
            <tr>
                <td>2</td>
                <td>Vino Kohlberg Tinto</td>
                <td><input type="number" value="1" min="1" class="cantidad"></td>
                <td class="precio">28</td>
                <td class="subtotal">28</td>
            </tr>
        </tbody>
        <tfoot>
            <tr>
                <th colspan="4" style="text-align:right">Total:</th>
                <th id="total">253</th>
            </tr>
        </tfoot>
    </table>

    <button class="btn-confirmar" onclick="confirmarVenta()">Confirmar Venta</button>
</div>

<script>
// Actualizar subtotales y total
const cantidades = document.querySelectorAll('.cantidad');
const filas = document.querySelectorAll('.tabla-venta tbody tr');
const totalElem = document.getElementById('total');

function actualizarTotal() {
    let total = 0;
    filas.forEach(fila => {
        const cantidad = parseInt(fila.querySelector('.cantidad').value);
        const precio = parseFloat(fila.querySelector('.precio').innerText);
        const subtotal = cantidad * precio;
        fila.querySelector('.subtotal').innerText = subtotal.toFixed(2);
        total += subtotal;
    });
    totalElem.innerText = total.toFixed(2);
}

cantidades.forEach(input => {
    input.addEventListener('change', actualizarTotal);
    input.addEventListener('input', actualizarTotal);
});

actualizarTotal();

// Función para enviar al recibo
function confirmarVenta() {
    let carrito = [];
    filas.forEach(fila => {
        carrito.push({
            nombre: fila.cells[1].innerText,
            precio: parseFloat(fila.cells[3].innerText),
            cantidad: parseInt(fila.cells[2].querySelector('input').value),
            presentacion: "" // opcional si quieres agregar
        });
    });

    // Guardar cliente en localStorage
    localStorage.setItem('cliente', JSON.stringify({
        nombre: document.getElementById('nombre').innerText,
        nit: document.getElementById('nit').innerText
    }));

    // Guardar carrito en localStorage
    localStorage.setItem('carrito', JSON.stringify(carrito));

    // Redirigir a recibo
    window.location.href = 'recibos.html';
}
</script>
</body>
</html>
